---
title: "Spatial & Temporal Associations Between Drug Treatment Center Operation and Fatal Opioid Overdoses in Cook County, IL, 2014-2024"
subtitle: "BMIN503/EPID600 Final Project"
author: "Jamie Benson"
format: html
editor: visual
number-sections: true
embed-resources: true
---

------------------------------------------------------------------------

```{r}
#| label: setup

library(tidyverse)
library(kableExtra)
library(leaflet)
library(tmap)
library(ggthemes)
library(flextable)
library(sf)

# Load targets
library(targets)
```

## Overview {#sec-overview}

Give a brief a description of your project and its goal(s), what data you are using to complete it, and what two faculty/staff in different fields you have spoken to about your project with a brief summary of what you learned from each person. Include a link to your final project GitHub repository.

## Introduction {#sec-introduction}

Opioid use disorder (OUD) represents a persistent public health crisis in the United States, contributing substantially to national mortality, morbidity, and healthcare expenditure. Recent estimates found a 289% increase in unintentional opioid-related mortality between 2011 and 2021, with particularly pronounced effects observed during the COVID-19 pandemic. During this period, years of life lost (YLL) from opioid-related causes increased by 62.9%, with adolescents aged 15-19 experiencing a 160% increase in YLL, from 1.5 to 3.9 years per 1,000 individuals. (**Citations are in Zotero, I just need to bring them in with Bibtex**)

Treatment approaches for OUD encompass both inpatient detoxification and outpatient services, including medication-assisted treatment (MAT) with partial opioid agonists such as buprenorphine, naltrexone, and methadone.Despite demonstrated efficacy, significant treatment gaps persist, with approximately 40% of U.S. counties lacking authorized buprenorphine providers as of 2018. Access disparities are particularly evident along the rural-urban continuum, where facility density and treatment modality availability vary substantially.

This study aims to examine the temporal and spatial associations between drug treatment center operations and incident neighborhood opioid overdose fatalities in a large U.S. metropolitan area. Specifically, I will investigate: 1) the relationship between facility opening/closure events and changes in following year areal overdose rates, 2) spatial spillover effects on adjacent areas, and 3) the correlation of these effects with community social vulnerability indicators.

## Methods {#sec-methods}

The analysis pipeline was run using the R: Targets platform given the large volume of moving parts. This allows for flexible iteration and for me to ensure all components are up to date, and that I am not re-running things unnecessarily if a given component of the analysis is up to date.

The pipeline is summarized and visualized below:
```{r}
tar_manifest()
tar_visnetwork()
tar_make()
```

**Drug Treatment Centers** The National Survey of Substance Abuse Treatment Services (N-SSATS) is conducted by the Substance Abuse and Mental Health Services Administration (SAMSHA) on an annual basis. Facilities which voluntarily responded and agreed to be represented are included in the directory. For each facility, information on their service offerings, licensure, payment forms and funding structure, street address, and contact information are collected.

I obtained N-SSATS directory listings in PDF format for the years 2005-2021, and CSV format for 2022-2024. Prior to 2005, the text was not directly embedded in each PDF document, and was instead created through optical character recognition, introducing significant barriers to data cleaning. Data ingestion from each PDF was performed using the R package readPDF.

Similar to other studies (Cantor 2022), I linked facilities longitudinally across years using geolocation (ArcGIS Pro, V.10.8.2; Esri) and probabilistic linkage. I conducted this "fuzzy" linkage by generating Jaro-Winkler string similarity scores for each field of each clinic-year observation (**CITE**). Pairwise comparisons were blocked within postal near-neighbor clusters of 50 clinics for computational efficiency. The sub-scores for geocoded X/Y coordinates, street address, and clinic name were weighted at 4,3, and 1 respectively, then summed into a total score. Pairwise comparisons with similarity scores above the 95th percentile were considered true matches, and above the 90th percentile considered likely matches: among those, the highest similarity scoring candidate was chosen. Matching was conducted using the reclin2 package. DTCs were occasionally listed under two different entities providing different services, or on different floors of the same street address. As our unit of analysis is the point location of each DTC, centers meeting these criteria (and which were geolocated within 200ft of one another) were represented as a single site, using the most common lat/lon coordinate pair in the group.

**Overdose Fatalities** Geolocated fatal overdoses were obtained from the Cook County, IL, medical examiner's office, which provides a live API feed with all decedents under the jurisdiction of the medical exmainer. This includes a near-census of fatal opioid overdoses occurring out of the hospital. Opioid overdoses were identified using regex string comparison of known drug names contianed in primary and secondary cause of death fields, as well as the medical exmainer's determination of "opioid involvement."

**Community Covariates** I obtained and linked block-group level community socio-demographic variables from the American Communities Survey (ACS) 5-year estimates. Shapefiles and source tables were retrieved from the IPUMS National Historical Geographic Information System (NHGIS), and the U.S. Census Bureau via tidycensus.

ACS variables included median household income, race and ethnicity counts, sex, owner-occupied housing, female-headed households with children, educational attainment > 25 years of age, and total population. From these variables we calculated both the Neighborhood Deprivation Score (NDS) and the Index of Concentration at the Extremes (ICE), as described by Furr-Holden et. al. For multivariate models, DTCs were assigned the covariates of the block group containing them.

**Primary Outcome** The primary outcome of interest was the incidence of fatal overdose in the geographic area surrounding DTCs. Density calculations were performed using concentric rings centered around the point location of each DTC, with the density determined by dividing the count of overdoses within each ring by the total area of the ring, for each year. Ring sizes were selected at even Euclidean 100ft radius increments, up to 0.5mi, a common cutoff for "within walking distance" in a city.

The second measure we explored was the median Euclidean distance to an overdose from each DTC. We compare the discriminatory ability of these two measures in sensitivity analysis. 

## Results {#sec-results}

Initial results:

This code chunk shows the number of clinics identified over the last 20 years in Cook County:
```{r}

tar_load(clinic_year_summary)
tar_load(plot_clinic_year)
tar_load(plot_clinic_year_matrix)

flextable(clinic_year_summary[[1]])

plot_clinic_year

plot_clinic_year_matrix

```

Here is a map of them:
```{r}
tar_load(basemap)
tar_load(clinics_open)

basemap %>%
  addCircleMarkers(data = clinics_open %>% st_transform('+proj=longlat +datum=WGS84'),
    stroke = FALSE, fillOpacity = 0.5, radius = 2
  ) 

```

Here is a map showing all the layers I am using for analysis overlaid! It's a lot. Yellow is clinics. Red is overdoses. ICE score is a chloropleth behind it all on the block groups.

```{r}
tar_load(all_layer_map)

all_layer_map
```

This shows a map of the overdose rate per 1,000 residents in each block group.
```{r}
tar_load(od_rate_map)

od_rate_map
```

Lastly, these show tables of VERY preliminary results from two difference in difference models, one looking at the estimated change in density of overdoses per square kilometer within a given buffer size, and one looking at the change in distance to an overdose, both following the opening of a clinic.
```{r}
tar_load(att_open_buffer)
tar_load(att_open_dist)

flextable(att_open_buffer)
flextable(att_open_dist)
```

## Conclusion

Too early to say!